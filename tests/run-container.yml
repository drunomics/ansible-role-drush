# Runs or removes a container for testing a playbook.
#
# Usage:
# - To start the container, run:
#   ansible-playbook run-container.yml --tags=start
# - To stop and remove the container, run:
#   ansible-playbook run-container.yml --tags=remove
---
- hosts: local
  vars:
    # Note that the container name matches the inventory as generated by
    # "inventory/container.sh"
    container_name: "ansible-run-{{ ansible_env.playbook | default('test-playbook') }}"
    docker_image: ubuntu-upstart:14.04
  tasks:
    - name: Start playbook container
      docker:
        name: "{{ container_name }}"
        image: "{{ docker_image }}"
        state: reloaded
      tags: start

    - name: Quickly stop playbook container
      docker:
        name: "{{ container_name }}"
        image: "{{ docker_image }}"
        state: killed
      tags: remove
    - name: Remove playbook container
      docker:
        name: "{{ container_name }}"
        image: "{{ docker_image }}"
        state: absent
      tags: remove
